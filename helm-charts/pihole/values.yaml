replicaCount: 1

image:
  repository: pihole/pihole
  tag: latest
  pullPolicy: IfNotPresent

timezone: "Europe/London"
adminPassword: "correct horse battery staple"

# Use the node's network (essential for RPi without MetalLB)
hostNetwork: true

# The MoJo2600 chart uses extraEnv for v6 engine configuration
extraEnv:
  # V6 ENGINE SETTINGS
  FTLCONF_webserver_api_enabled: "true"
  FTLCONF_webserver_api_allowedHosts: "*"
  FTLCONF_webserver_servername: "pi.hole"
  
  # TRUSTED PROXIES: Dynamic range for K8s internal networking
  FTLCONF_webserver_api_trustedProxies: "10.0.0.0/8,172.16.0.0/12,192.168.0.0/16"
  
  # DNS SETTINGS: Prevent internal pod IP from leaking into DNS
  FTLCONF_dns_hostRecord: "false"
  FTLCONF_dns_listeningMode: "all"

# Required for RPi hardware access and network management
securityContext:
  privileged: true
  capabilities:
    add:
      - NET_ADMIN
      - SYS_TIME
      - SYS_NICE
      - CHOWN

persistence:
  storageClass: "local-path"
  pihole:
    size: 2Gi
  dnsmasq:
    size: 1Gi

service:
  type: ClusterIP
  dnsUdpPort: 53
  dnsTcpPort: 53
  webPort: 80 
  httpsPort: 443

ingress:
  enabled: true
  className: nginx
  annotations:
    # Disable SSL redirect to prevent 308 loops
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "false"
    # Ensure Ingress tells Pi-hole it's looking for "pi.hole"
    nginx.ingress.kubernetes.io/upstream-vhost: "pi.hole"
    nginx.ingress.kubernetes.io/proxy-body-size: "0"
  hosts:
    - host: pi.hole
      paths:
        - path: /
          pathType: Prefix